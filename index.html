<html xmlns="http://www.w3.org/2000/svg">
	<head>
		<meta http-equiv="Content-Type" content="image/svg+xml" />
		<script src="script/Counter.js"></script>
		<script src="script/HttpClient.js"></script>
		<script>
			let starsCounter = new Counter();
			console.log(starsCounter.getValue());
			let githubApiClient = HttpClient.newInstance("https://api.github.com");
			
			function updateStarImage(starsCount) {
				let starsImage = document.getElementById('star');
				if (typeof starsImage == "undefined" || starsImage == null) {
					starsImage = document.createElement('img');
					starsImage.setAttribute("id", "star");
					document.getElementsByTagName('BODY')[0].appendChild(starsImage);
				}

				starsImage.src = 'data:image/svg+xml,' 
					+ encodeURIComponent(`
						<svg xmlns="http://www.w3.org/2000/svg" width="165" height="120">
								<polygon points = "90,5 30,120 165,50 15,50 150,120" fill = "yellow"/>
								<text fill="red" font-size="60" font-family="Times New Roman" x="58" y="90">${starsCount}</text>
						</svg>
					`);
			}

			function innerRepo(response) {
				starsCounter.increase(response["stargazers_count"]);
				updateStarImage(starsCounter.getValue());
			}

			function innerRepos(response, excludeRepos) {
				for(var k in response) {
					if (excludeRepos.includes(response[k]["name"])) continue;

					innerRepo(response[k])
				}
			}

			function main() {
				let url = new URL(window.location.href);

				updateStarImage(0);

				let excludeRepos = url.searchParams.getAll("exclude_repo");
				if (!Array.isArray(excludeRepos)) {
					excludeRepos = [];
				}

				let users = url.searchParams.getAll("user");
				if (Array.isArray(users)) {
					for(var user in users) {
						console.log(users[user])
						githubApiClient.requestGet(`users/${users[user]}/repos`, innerRepos, excludeRepos);
					}
				}
			}
		</script>
	</head>
	<body onload="main()">

	</body>
</html>